<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- Ensures correct scaling on mobile devices ‚Äî critical for canvas responsiveness -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Intention Keeper - Geometric Visualization</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>Intention Keeper</h1>
            <p class="tagline">Transform Your Intention Into Geometric Patterns</p>
            <p class="tagline-sub">A consciousness visualization tool</p>
        </header>

        <main>
            <!-- INPUT SECTION
                 User enters their intention here. Word counter updates in real time.
                 The Analyze button is disabled if the intention exceeds 50 words. -->
            <section class="input-section">
                <h2>Enter Your Intention</h2>
                <p class="instruction">Intention = Purpose + Attention. What do you intend to do, and why? Think it through before you type it.</p>
                <textarea id="intentionInput" rows="4" placeholder="Type your intention here..."></textarea>
                <div class="word-counter">
                    <span id="wordCount">0</span> / 50 words
                    <span id="wordWarning" style="display: none; color: #e74c3c; font-weight: bold; margin-left: 10px;">‚ö†Ô∏è Exceeds limit</span>
                </div>
                <button class="primary-btn" id="analyzeBtn">Analyze Intention</button>
            </section>

            <!-- ANALYSIS SECTION
                 Hidden until the user submits an intention.
                 Displays consciousness analysis feedback and branching options:
                 - Harmful content: forced reframe, no bypass
                 - Neutral content: suggested reframe with override option
                 - Conscious/transcendent: direct path to mandala generation -->
            <section class="analysis-section" id="analysisSection" style="display: none;">
                <h2>Consciousness Analysis</h2>
                <div id="feedbackMessage" class="feedback-message"></div>

                <!-- Reframe panel ‚Äî shown for harmful or neutral intentions -->
                <div id="reframedSection" class="reframed-intention" style="display: none;">
                    <h3>Reframed Intention</h3>
                    <p class="reframed-text" id="reframedText"></p>
                    <button class="primary-btn" id="acceptReframeBtn">Accept Reframed Intention</button>
                    <!-- keepOriginalBtn is only shown for neutral intentions, never for harmful -->
                    <button class="secondary-btn" id="keepOriginalBtn" style="display: none;">Keep Original (I Understand)</button>
                </div>

                <!-- Direct generate panel ‚Äî shown when intention passes analysis -->
                <div id="directGenerateSection" style="display: none;">
                    <button class="primary-btn" id="generateDirectBtn">Generate Mandala</button>
                </div>
            </section>

            <!-- MANDALA SECTION
                 Hidden until mandala generation is triggered.
                 Contains the canvas, cryptographic signature, audio controls, and download options.
                 Canvas dimensions are set dynamically in mandala.js based on viewport size. -->
            <section class="mandala-section" id="mandalaSection" style="display: none;">
                <h2>Your Geometric Pattern</h2>
                <p class="mandala-subtitle">A unique visualization generated from your intention</p>

                <canvas id="mandalaCanvas" width="600" height="600"></canvas>

                <div class="mandala-info">
                    <p class="hash-display">Cryptographic Signature: <span id="hashDisplay"></span></p>
                </div>

                <!-- Controls row: download and audio mute/unmute side by side -->
                <div class="controls">
                    <button class="secondary-btn" id="downloadPngBtn">Download PNG</button>

                    <!-- Mute button toggles the hash-seeded audio soundscape.
                         Label updates dynamically in app.js to reflect current state. -->
                    <button class="secondary-btn" id="muteBtn">üîä Mute Audio</button>

                    <button class="secondary-btn" disabled style="opacity: 0.6; cursor: not-allowed;">GIF Export (Coming Soon)</button>
                </div>
            </section>
        </main>

        <footer>
            <p style="font-size: 1.2em; font-weight: bold; color: #f39c12; margin-bottom: 10px;">
                The Intention Keeper ‚Ä¢ v3.2 ‚Ä¢ For the Good of All Humanity
            </p>
            <p style="color: #95a5a6;">
                Transcendence Detection ‚Ä¢ SHA-256 Mathematics ‚Ä¢ No Dogma ‚Ä¢ Pure Transformation
            </p>
        </footer>
    </div>

    <!-- Script load order matters:
         hash-encoder must load before mandala (spherical coord functions)
         audio must load before app (AudioEngine instantiated in app.js)
         app loads last as it depends on all other modules -->
    <script src="js/hash-encoder.js"></script>
    <script src="js/intention-analyzer.js"></script>
    <script src="js/mandala.js"></script>
    <script src="js/audio.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
